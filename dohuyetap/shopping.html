<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!-- Required meta tags -->

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="author" content="LamPT" />
    <meta name="description" content="Máy đo huyết áp Yamada" />
    <meta
      name="keywords"
      content="Yamada, đo huyết áp yamada, huyết áp, máy đo huyết áp"
    />

    <meta
      property="og:url"
      content="http://yamadacare.vn/dohuyetap/shopping.html"
    />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Máy đo huyết áp Yamada" />
    <meta property="og:image" content="img/nhiet ke yamada 2.jpg" />
    <meta property="og:description" content="Máy đo huyết áp Yamada" />

    <title>Máy đo huyết áp điện tử Yamada | Trang mua hàng</title>

    <link rel="shortcut icon" type="image/png" href="/assets/img/favicon.ico" />

    <!-- Site library -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <link
      href="https://cdn.lineicons.com/1.0.1/LineIcons.min.css"
      rel="stylesheet"
    />

    <!-- Page library -->
    <link rel="stylesheet" type="text/css" href="css/shopping.css" />

    <!-- Global site tag (gtag.js) - Google Ads: 806236185 -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=AW-806236185"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', 'AW-806236185');
    </script>
    <!-- Facebook Pixel Code -->
    <script>
      !(function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
          n.callMethod
            ? n.callMethod.apply(n, arguments)
            : n.queue.push(arguments);
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = '2.0';
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        t.src = v;
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s);
      })(
        window,
        document,
        'script',
        'https://connect.facebook.net/en_US/fbevents.js',
      );
      fbq('init', '2494509324104371');
      fbq('track', 'PageView');
    </script>
    <noscript
      ><img
        height="1"
        width="1"
        style="display: none"
        src="https://www.facebook.com/tr?id=2494509324104371&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Facebook Pixel Code -->

    <!-- email settings -->
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"
    ></script>
    <script type="text/javascript">
      (function () {
        emailjs.init('user_10EW8QCywsxKiHtS70vf8');
      })();
    </script>
  </head>

  <body>
    <div id="cart" class="container text-center pt-3 pb-5">
      <img
        src="/assets/img/logo.png"
        alt="logo"
        class="img-fluid"
        width="200px"
      />

      <h3 class="mt-3">Đặt mua ngay Máy đo huyết áp Yamada</h3>

      <div class="container">
        <div class="row justify-content-center">
          <div v-for="product in products" class="col-6">
            <div class="mt-3 product-box">
              <div class="row">
                <div class="col-6">
                  <img
                    class="img-fluid"
                    :src="product.image"
                    :alt="product.slug"
                  />
                </div>
                <div class="col-6 d-flex flex-column justify-content-center">
                  <h5>{{product.name}}</h5>

                  <p>{{convertToViCurrency(product.price)}}</p>
                  <del>{{convertToViCurrency(product.delPrice)}}</del>
                  <div class="mt-2">
                    <input
                      type="checkbox"
                      :id="product.slug"
                      class="pega"
                      v-model="product.checked"
                    />
                    <label
                      :for="product.slug"
                      :name="product.slug"
                      class="pega"
                    >
                      MUA
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <p
              v-if="product.type == 'main'"
              style="max-width: 700px; margin: 10px auto 0"
            >
              <i>
                * Sản phẩm được <b>miễn phí vận chuyển toàn quốc</b>, khách hàng
                được <b>kiểm tra hàng trước khi thanh toán</b>.
              </i>
            </p>
          </div>
        </div>
      </div>

      <div class="row mt-5">
        <div class="col-md-6 col-xs-12 order-md-1 order-2">
          <h3>THÔNG TIN MUA HÀNG</h3>
          <div class="form text-center pb-3">
            <form>
              <div class="form-group">
                <input
                  name="name"
                  type="text"
                  class="form-control"
                  placeholder="Họ và tên (bắt buộc)"
                  v-model="customer.name"
                />
              </div>
              <div class="form-group">
                <input
                  name="email"
                  type="text"
                  class="form-control"
                  placeholder="Email"
                  v-model="customer.email"
                />
              </div>
              <div class="form-group">
                <input
                  name="phone"
                  type="text"
                  id="phone"
                  class="form-control"
                  placeholder="Nhập số điện thoại (bắt buộc)"
                  v-model="customer.phone"
                />
              </div>
              <div class="form-group">
                <p class="font-italic text-left">
                  * Để tránh nhầm lẫn, xin vui lòng kiểm tra kỹ và nhập lại số
                  điện thoại!
                </p>
                <input
                  name="confirmPhone"
                  type="text"
                  class="form-control"
                  placeholder="Xác nhận số điện thoại (bắt buộc)"
                  v-model="customer.confirmPhone"
                />
              </div>
              <div class="form-group">
                <textarea
                  name="address"
                  class="form-control"
                  rows="5"
                  placeholder="Nhập địa chỉ của bạn (bắt buộc)"
                  v-model="customer.address"
                ></textarea>
              </div>
              <div class="text-center mt-3">
                <button type="submit" class="btn order-btn" @click="sendForm">
                  Đặt mua ngay
                </button>
              </div>
            </form>

            <div class="text-center mt-3">
              <button
                type="button"
                onclick="window.history.back()"
                class="btn btn-info"
              >
                Quay lại
              </button>
            </div>
          </div>
        </div>
        <div class="col-md-6 col-xs-12 order-md-2 order-1">
          <h3>GIỎ HÀNG</h3>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>STT</th>
                <th>Tên sản phẩm</th>
                <th>Số lượng</th>
                <th>Đơn giá</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="product in products" v-show="product.checked">
                <td>{{product.id}}</td>
                <td>{{product.name}}</td>
                <td>
                  <div class="d-flex justify-content-center">
                    <button type="button" @click="subQuantity(product)">
                      -
                    </button>
                    <span>{{product.quantity}}</span>
                    <button type="button" @click="addQuantity(product)">
                      +
                    </button>
                  </div>
                </td>
                <td>{{convertToViCurrency(finalPriceOf(product))}}</td>
              </tr>

              <tr>
                <td colspan="3">Tổng giá</td>
                <td>{{convertToViCurrency(totalPrice)}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div
      class="modal fade"
      id="confirmModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="modelTitleId"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Xác nhận thanh toán</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body"></div>
          <div class="caution"></div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Huỷ
            </button>
            <button type="button" class="btn btn-primary" id="cont-btn">
              Tiếp tục
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Site library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
    <script>
      new Vue({
        el: '#cart',
        data: {
          customer: {
            name: '',
            email: '',
            address: '',
            phone: '',
            confirmPhone: '',
          },
          products: [
            {
              id: 1,
              name: 'Máy đo huyết áp',
              quantity: 1,
              checked: true,
              price: 659000,
              type: 'main',
              slug: 'huyetap',
              delPrice: 930000,
              image: 'img/huyetap.jpg',
            },
            // {
            //   id: 2,
            //   name: 'Bộ đổi nguồn',
            //   quantity: 1,
            //   checked: false,
            //   price: 45000,
            //   type: 'item',
            //   slug: 'adapter',
            //   delPrice: 150000,
            //   image: 'img/huyetap_sac.JPG',
            // },
            // {
            //   id: 3,
            //   name: 'Bao da cao cấp',
            //   quantity: 1,
            //   checked: false,
            //   price: 30000,
            //   type: 'item',
            //   slug: 'baoda',
            //   delPrice: 70000,
            //   image: 'img/huyetap_hop.JPG',
            // },
          ],
        },
        methods: {
          addQuantity(product) {
            product.quantity += 1;
          },
          subQuantity(product) {
            product.quantity -= product.quantity > 1 ? 1 : 0;
          },
          finalPriceOf(product) {
            return product.checked ? product.quantity * product.price : 0;
          },
          convertToViCurrency(price) {
            return price.toLocaleString('it-IT', {
              style: 'currency',
              currency: 'vnd',
            });
          },
          sendForm(e) {
            e.preventDefault();
            if ($('form').valid()) {
              const { customer, products, totalPrice, convertToViCurrency } =
                this;
              const { name, phone, address, email } = customer;

              const cartInfoHTML = (products) => {
                let str = '';
                products.forEach((product) => {
                  str += product.checked
                    ? `
                      <p>${product.name}</p>
                      <p>SL: ${product.quantity}</p>
                      <p>
                        Giá: ${convertToViCurrency(
                          product.price * product.quantity,
                        )}
                      </p><hr />
                      `
                    : '';
                });
                return str;
              };

              const cartInfoStr = function (products) {
                let str = '';
                products.forEach((product) => {
                  str += product.checked
                    ? `
                      ${product.name} (x${product.quantity}) - ${
                        product.quantity * product.price
                      }
                      `
                    : '';
                });
                return str;
              };

              $('#confirmModal .modal-body')
                .html('')
                .append(
                  `
                    <h4>Thông tin cá nhân:</h4>
                    <p>Họ tên: <span>${name}</span></p>
                    <p>SĐT: <span>${phone}</span></p>
                    <p>Địa chỉ: <span>${address}</span></p>
                    <p>Email: <span>${email}</span></p>
                    <h4 class="mt-2">Đơn hàng của bạn: </h4>
                    ${cartInfoHTML(products)}
                    <p>Tổng tiền: ${convertToViCurrency(totalPrice)}</p>
                    <i style="font-size: 11px">*Xin vui lòng kiểm tra lại kĩ thông tin 1 lần nữa</i>
                  `,
                );
              $('#confirmModal').modal({
                backdrop: 'static',
                keyboard: false,
              });

              $('#cont-btn').on('click', function () {
                $('#cont-btn').attr('disabled', true);
                $('.caution').append('Xin chờ trong giây lát...');

                let data = {
                  ...customer,
                  products: cartInfoStr(products),
                  total: totalPrice,
                };
                //send email
                emailjs
                  .send('service_ryhkd2l', 'template_dgedooh', {
                    subject: `Khách hàng ${data.name} mua huyết áp`,
                    reply_to:
                      'sonpt91.bkhn@gmail.com, store.anphu@gmail.com, vuvantrung21@gmail.com',
                    body: `1. Tên khách hàng: ${data.name}, 2.Email: ${data.email}, 3. SĐT: ${data.phone}, 4. Địa chỉ: ${data.address}, 5. Đơn hàng: ${data.products}, 6. Tổng tiền: ${data.total}`,
                  })
                  .then((message) => console.log(message));

                // fill in gg excel
                var dataUrl =
                  'https://script.google.com/macros/s/AKfycbwPu8pg27OnnmoNTB_35PvksuV_QwSXepws5M2DknSI9aoQ5rk/exec';

                $.ajax({
                  type: 'POST',
                  url: dataUrl,
                  dataType: 'json',
                  crossDomain: true,
                  data: data,
                  success: function (response) {
                    window.location = 'thanks.html';
                  },
                });
              });
            }
          },
        },
        computed: {
          totalPrice: function () {
            return this.products.reduce(
              (total, product) => total + this.finalPriceOf(product),
              0,
            );
          },
        },
      });
    </script>

    <!-- Page library -->
    <script src="js/shopping.js"></script>
  </body>
</html>
